Here you go â€“ this will fix the â€œBook Appointmentâ€ spam problem and make it show only when someone actually wants to book.

Copyâ€“paste this whole thing into Replit Agent:

â¸»

ğŸ”§ REPLIT PROMPT â€” FIX BOOKING BUTTON SPAM (SHOW ONLY ON REAL BOOKING INTENT)

You are working on the Treasure Coast AI platform.

Right now, the public chatbot widget shows a â€œBook Appointmentâ€ button after every response.
This is wrong.

We need to change the behavior so that:
	â€¢	The button is only shown when the user clearly wants to book.
	â€¢	Normal Q&A / info conversations do NOT show a booking button.
	â€¢	The platform still follows the rule:
â€œAI assistant captures info and redirects to the clientâ€™s external booking service. It never books internally or handles payments.â€

Do NOT change the business model.
Do NOT allow direct booking or payment in the assistant.

â¸»

ğŸ¯ GOAL BEHAVIOR

The â€œBook Appointmentâ€ button MUST:

âœ… Only appear when there is booking intent, such as:
	â€¢	â€œI want to book an appointment.â€
	â€¢	â€œCan I schedule Botox?â€
	â€¢	â€œHow do I book?â€
	â€¢	â€œDo you have availability tomorrow?â€
	â€¢	â€œI want to come in Friday.â€
	â€¢	â€œCan I make an appointment?â€

âœ… Preferably appear:
	â€¢	After the assistant has:
	â€¢	Confirmed what they want (service/date/time)
	â€¢	Collected basic info (name, contact if needed)

âœ… Always redirect to the configured external booking URL for that bot.

â¸»

The â€œBook Appointmentâ€ button MUST NOT:

âŒ Show up after every single answer.
âŒ Show when the user is just asking questions (hours, prices, safety, etc.).
âŒ Show randomly on general informational responses.
âŒ Claim that the appointment is fully booked/confirmed inside the chat.
âŒ Handle payments or ask for card details.

â¸»

ğŸ” STEP 1 â€” FIND CURRENT BOOKING BUTTON LOGIC
	1.	Locate the code that renders the â€œBook Appointmentâ€ button in the widget UI.
	â€¢	This is probably in the shared chat hook or message rendering components, something like:
	â€¢	useChatAssistant
	â€¢	message list / chat UI
	â€¢	where the button text is defined and rendered.
	2.	Identify how it currently decides when to show the button.
	â€¢	Right now, it looks like itâ€™s using a simple flag or generic condition thatâ€™s being set for most/all replies.
	â€¢	Document the current logic in comments as you find it.

â¸»

ğŸ§  STEP 2 â€” IMPLEMENT BOOKING INTENT DETECTION

We need a clean, centralized way to determine â€œis the user trying to book?â€ based on the conversation.

You can implement this in one of these layers (choose what fits the codebase best):
	â€¢	In the chat backend where messages are processed; or
	â€¢	In the frontend hook useChatAssistant by inspecting user messages; or
	â€¢	In a shared helper that both sides can use.

Minimum booking intent heuristic

Create a helper like:

function isBookingIntent(message: string): boolean {
  const text = message.toLowerCase();
  const bookingKeywords = [
    "book",
    "appointment",
    "schedule",
    "reservation",
    "consultation",
    "come in",
    "make an appointment",
    "can i come",
    "can i visit",
    "availability",
    "available times",
  ];

  return bookingKeywords.some((kw) => text.includes(kw));
}

Enhance if needed with context:
	â€¢	Check last user message and possibly the last 2â€“3 messages.

Where to use this:
	â€¢	When a user message comes in, determine if it has booking intent.
	â€¢	Set a flag in the conversation/session state, something like:
	â€¢	conversation.bookingIntent = true for this turn/session
	â€¢	Use that flag on the response side to decide whether to show the button.

Do NOT use AI system prompt to always show the button â€“ the UI logic must decide.

â¸»

ğŸ§± STEP 3 â€” UPDATE BOOKING BUTTON RENDERING LOGIC

Replace the current â€œalways showâ€ or overly broad logic with a strict condition.

Pseudo-logic:

// in the widget UI or chat component

const shouldShowBookingButton =
  hasBookingUrl &&   // there is a configured external booking URL
  lastUserMessageWasBookingIntent && // our detection result
  !widgetState.hasJustShownBookingButtonForThisIntent; // avoid spamming it

Key rules:
	1.	Require a valid booking URL for this bot:
	â€¢	If no bookingUrl is set in config, do NOT show the button even if user wants to book.
	â€¢	In that case, assistant should say:
	â€¢	â€œIâ€™ve passed your details to the staff, theyâ€™ll contact you to confirm.â€
	2.	Tie display to MOST RECENT USER MESSAGE:
	â€¢	Only show the button when the latest user message expresses booking intent.
	3.	Avoid multiple redundant buttons:
	â€¢	If the same intent has already resulted in a booking button within this conversation, avoid spamming the button multiple turns in a row.
	â€¢	Keep a simple state flag in the session: bookingButtonShownForCurrentIntent.

â¸»

ğŸ’¬ STEP 4 â€” ALIGN ASSISTANT RESPONSES WITH UI LOGIC

Update the assistant behavior (system prompt / config) so it assumes:
	â€¢	The UI will show a â€œBook Appointmentâ€ button when booking intent is detected.
	â€¢	The assistant should:
	â€¢	Recognize intent
	â€¢	Ask for relevant details (name, email, phone, preferred time, service)
	â€¢	Then refer to â€œthe booking buttonâ€ in its wording.

Example pattern:

â€œI can help with that. Iâ€™ve captured your details.
To finish booking, please click the â€˜Book Appointmentâ€™ button so you can choose a time and complete it on the clinicâ€™s booking page.â€

Make sure the assistant:
	â€¢	Does not say â€œyour appointment is confirmed.â€
	â€¢	Does not act like it controls the calendar.
	â€¢	Keeps messaging consistent with â€œwe redirect you to the businessâ€™s booking system.â€

â¸»

ğŸ§ª STEP 5 â€” TEST CASES TO IMPLEMENT & RUN

Add or run tests (automated or manual) to verify behavior.

Case A â€” Pure Info Questions (NO button)

User:
	â€¢	â€œWhat are your hours?â€
	â€¢	â€œDo you offer Botox?â€
	â€¢	â€œHow much is Botox?â€
	â€¢	â€œIs Botox safe?â€

Expected:
	â€¢	Assistant answers normally.
	â€¢	No â€œBook Appointmentâ€ button after these answers.

Case B â€” Booking Intent Question (SHOW button)

User:
	â€¢	â€œI want to book Botox tomorrow.â€
	â€¢	â€œCan I schedule an appointment?â€
	â€¢	â€œHow do I book a consultation?â€

Expected:
	â€¢	Assistant:
	â€¢	Recognizes booking intent
	â€¢	Captures relevant info
	â€¢	Button appears once
	â€¢	Text clearly tells them to click button to complete booking externally.

Case C â€” Mixed Flow
	1.	User asks info: â€œWhat is microneedling?â€
â†’ Response: info only, no button.
	2.	User then says: â€œOkay, I want to book microneedling.â€
â†’ Response: now show â€œBook Appointmentâ€ button.

Case D â€” No Booking URL Configured
	â€¢	Remove/leave blank the booking URL in config for a test bot.
	â€¢	User: â€œI want to book an appointment.â€

Expected:
	â€¢	Assistant politely says it will pass info to staff / theyâ€™ll call to schedule.
	â€¢	No button.

Case E â€” Spam / Multiple Intents

User sends:
	â€¢	â€œI want to book.â€
	â€¢	Then again: â€œAre you sure I can book?â€

Expected:
	â€¢	First time: Show button.
	â€¢	Second: either reuse mention of the button, but donâ€™t stack multiple new identical buttons.

â¸»

ğŸ” STEP 6 â€” REGRESSION CHECKS

After changing logic:
	â€¢	Verify no crashes in widget.
	â€¢	Verify booking still:
	â€¢	tracks clicks
	â€¢	logs leads
	â€¢	updates dashboards (client + admin)
	â€¢	Make sure nothing in the booking logic:
	â€¢	modifies direct booking behavior
	â€¢	handles payments
	â€¢	over-promises confirmations

â¸»

âœ… ACCEPTANCE CRITERIA

This change is complete and correct when:
	1.	â€œBook Appointmentâ€ button is not shown in normal info Q&A.
	2.	It is only shown when booking intent is detected in the userâ€™s message.
	3.	It respects whether a booking URL is configured.
	4.	It does not spam multiple buttons for the same intent.
	5.	The assistantâ€™s language:
	â€¢	Never claims internal booking/confirmation.
	â€¢	Always frames booking as happening on the external page.
	6.	Lead and analytics behavior remain unchanged/working:
	â€¢	booking-intent leads still created
	â€¢	booking link clicks logged
	â€¢	dashboards still accurate.

Keep everything aligned with Treasure Coast AIâ€™s agency-first model.
No client self-service, no in-chat payments, no internal booking engine.

â¸»
